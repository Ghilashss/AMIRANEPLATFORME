<!-- ======================================
     FORMULAIRE COLIS COMPLET V2
     Design: Vert (#0b2b24, #16a34a)
     Responsive: 2 colonnes ‚Üí 1 colonne mobile
     ====================================== -->
<div id="colisModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-box"></i> Ajouter un Colis</h2>
      <span class="close-button">&times;</span>
    </div>
    <div class="modal-body">
      <form id="colisForm" class="param-form">
        <div class="form-columns">
          <!-- ============ COLONNE GAUCHE : EXP√âDITEUR ============ -->
          <div class="form-column-left">
            
            <!-- Section 1: Informations Exp√©diteur -->
            <div class="form-section">
              <h3 class="form-section-title">
                <i class="fas fa-user-tie"></i> Informations Exp√©diteur
              </h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="nomExpediteur">
                    <i class="fas fa-user"></i> Nom exp√©diteur <span class="required">*</span>
                  </label>
                  <input type="text" 
                         id="nomExpediteur" 
                         name="nomExpediteur" 
                         placeholder="Nom complet de l'exp√©diteur" 
                         required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="telExpediteur">
                    <i class="fas fa-phone"></i> T√©l√©phone exp√©diteur <span class="required">*</span>
                  </label>
                  <input type="tel" 
                         id="telExpediteur" 
                         name="telExpediteur" 
                         placeholder="0X XX XX XX XX" 
                         pattern="[0-9]{10}"
                         required>
                </div>
              </div>
            </div>

            <!-- Section 2: Localisation Exp√©diteur -->
            <div class="form-section">
              <h3 class="form-section-title">
                <i class="fas fa-map-marker-alt"></i> Localisation Exp√©diteur
              </h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="wilayaSource">
                    <i class="fas fa-map"></i> Wilaya exp√©diteur <span class="required">*</span>
                  </label>
                  <select id="wilayaSource" name="wilayaSource" required data-role-dependent="true">
                    <option value="">S√©lectionner une wilaya</option>
                    <!-- Charg√© dynamiquement depuis API frais-livraison -->
                  </select>
                  <small class="form-hint" data-role="agent,commercant" style="display: none;">
                    <i class="fas fa-info-circle"></i> Auto-rempli selon votre agence
                  </small>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="bureauSource">
                    <i class="fas fa-building"></i> Bureau exp√©diteur <span class="required">*</span>
                  </label>
                  <select id="bureauSource" name="bureauSource" required data-role-dependent="true">
                    <option value="">S√©lectionner le bureau source</option>
                    <!-- Charg√© dynamiquement selon wilaya s√©lectionn√©e -->
                  </select>
                  <small class="form-hint" data-role="agent,commercant" style="display: none;">
                    <i class="fas fa-info-circle"></i> Auto-rempli selon votre agence
                  </small>
                </div>
              </div>
            </div>

            <!-- Section 3: D√©tails du Colis -->
            <div class="form-section">
              <h3 class="form-section-title">
                <i class="fas fa-box-open"></i> D√©tails du Colis
              </h3>
              <div class="form-row form-row-2cols">
                <div class="form-group">
                  <label for="poidsColis">
                    <i class="fas fa-weight-hanging"></i> Poids (kg) <span class="required">*</span>
                  </label>
                  <input type="number" 
                         id="poidsColis" 
                         name="poidsColis" 
                         step="0.1" 
                         min="0.1"
                         placeholder="Ex: 2.5"
                         required>
                </div>
                <div class="form-group">
                  <label for="prixColis">
                    <i class="fas fa-coins"></i> Prix du colis (DA) <span class="required">*</span>
                  </label>
                  <input type="number" 
                         id="prixColis" 
                         name="prixColis" 
                         min="0"
                         placeholder="Ex: 5000"
                         required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="typeColis">
                    <i class="fas fa-tag"></i> Type de colis <span class="required">*</span>
                  </label>
                  <select id="typeColis" name="typeColis" required>
                    <option value="">S√©lectionner le type</option>
                    <option value="standard">üì¶ Standard</option>
                    <option value="fragile">‚ö†Ô∏è Fragile</option>
                    <option value="perissable">üßä P√©rissable</option>
                    <option value="electronique">üíª √âlectronique</option>
                    <option value="documents">üìÑ Documents</option>
                    <option value="autre">üìå Autre</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="contenuColis">
                    <i class="fas fa-cube"></i> Contenu du colis <span class="required">*</span>
                  </label>
                  <input type="text" 
                         id="contenuColis" 
                         name="contenuColis" 
                         placeholder="Ex: V√™tements, Chaussures, Livres..."
                         required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="description">
                    <i class="fas fa-align-left"></i> Description d√©taill√©e
                  </label>
                  <textarea id="description" 
                            name="description" 
                            rows="3" 
                            placeholder="Ajoutez des d√©tails suppl√©mentaires sur le colis..."></textarea>
                </div>
              </div>
            </div>

          </div>

          <!-- ============ COLONNE DROITE : DESTINATAIRE ============ -->
          <div class="form-column-right">
            
            <!-- Section 4: Informations Destinataire -->
            <div class="form-section">
              <h3 class="form-section-title">
                <i class="fas fa-user-check"></i> Informations Destinataire
              </h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="nomClient">
                    <i class="fas fa-user-circle"></i> Nom complet <span class="required">*</span>
                  </label>
                  <input type="text" 
                         id="nomClient" 
                         name="nomClient" 
                         placeholder="Nom du destinataire"
                         required>
                </div>
              </div>
              <div class="form-row form-row-2cols">
                <div class="form-group">
                  <label for="telClient">
                    <i class="fas fa-phone"></i> T√©l√©phone <span class="required">*</span>
                  </label>
                  <input type="tel" 
                         id="telClient" 
                         name="telClient" 
                         placeholder="0X XX XX XX XX"
                         pattern="[0-9]{10}"
                         required>
                </div>
                <div class="form-group">
                  <label for="telSecondaire">
                    <i class="fas fa-phone-square"></i> T√©l. secondaire
                  </label>
                  <input type="tel" 
                         id="telSecondaire" 
                         name="telSecondaire" 
                         placeholder="0X XX XX XX XX"
                         pattern="[0-9]{10}">
                </div>
              </div>
            </div>

            <!-- Section 5: Localisation Destinataire -->
            <div class="form-section">
              <h3 class="form-section-title">
                <i class="fas fa-shipping-fast"></i> Localisation Destinataire
              </h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="wilayaDest">
                    <i class="fas fa-map"></i> Wilaya destination <span class="required">*</span>
                  </label>
                  <select id="wilayaDest" name="wilayaDest" required>
                    <option value="">S√©lectionner une wilaya</option>
                    <!-- Charg√© dynamiquement depuis API frais-livraison -->
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="typelivraison">
                    <i class="fas fa-truck"></i> Type de livraison <span class="required">*</span>
                  </label>
                  <select id="typelivraison" name="typelivraison" required>
                    <option value="">S√©lectionner le type</option>
                    <option value="bureau">üè¢ Livraison au bureau</option>
                    <option value="domicile">üè† Livraison √† domicile</option>
                  </select>
                </div>
              </div>
              
              <!-- Champ conditionnel: Bureau Destination (si type = bureau) -->
              <div class="form-row" id="bureauDestRow" style="display: none;">
                <div class="form-group">
                  <label for="bureauDest">
                    <i class="fas fa-building"></i> Bureau destination <span class="required">*</span>
                  </label>
                  <select id="bureauDest" name="bureauDest">
                    <option value="">S√©lectionner un bureau</option>
                    <!-- Charg√© dynamiquement selon wilaya destinataire -->
                  </select>
                </div>
              </div>

              <!-- Champ conditionnel: Adresse (si type = domicile) -->
              <div class="form-row" id="adresseDomicileRow" style="display: none;">
                <div class="form-group">
                  <label for="adresseLivraison">
                    <i class="fas fa-home"></i> Adresse de livraison <span class="required">*</span>
                  </label>
                  <textarea id="adresseLivraison" 
                            name="adresseLivraison" 
                            rows="2" 
                            placeholder="Adresse compl√®te avec d√©tails (rue, quartier, points de rep√®re...)"></textarea>
                </div>
              </div>
            </div>

            <!-- Section 6: R√©sum√© des Frais -->
            <div class="form-section frais-section">
              <h3 class="form-section-title">
                <i class="fas fa-calculator"></i> R√©sum√© des Frais
              </h3>
              <div class="frais-details">
                <div class="frais-row">
                  <span class="frais-label">
                    <i class="fas fa-box"></i> Prix du colis
                  </span>
                  <span id="resumePrixColis" class="frais-value">0 DA</span>
                </div>
                <div class="frais-row">
                  <span class="frais-label">
                    <i class="fas fa-truck"></i> Frais de livraison
                  </span>
                  <span id="fraisLivraison" class="frais-value">0 DA</span>
                </div>
                <div class="frais-separator"></div>
                <div class="frais-row frais-total">
                  <span class="frais-label">
                    <i class="fas fa-money-bill-wave"></i> Total √† payer
                  </span>
                  <span id="totalAPayer" class="frais-value total">0 DA</span>
                </div>
              </div>
              <div class="frais-info">
                <i class="fas fa-info-circle"></i>
                <small>Les frais sont calcul√©s automatiquement selon la configuration tarifaire</small>
              </div>
            </div>

          </div>
        </div>

        <!-- Footer avec bouton de soumission -->
        <div class="modal-footer">
          <button type="button" class="btn-secondary" id="cancelColisBtn">
            <i class="fas fa-times"></i> Annuler
          </button>
          <button type="submit" class="btn-primary">
            <i class="fas fa-check"></i> Cr√©er le colis
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ======================================
     NOTES D'IMPL√âMENTATION
     ======================================
     
     1. CHAMPS AUTO-REMPLIS (Agent/Commer√ßant):
        - wilayaSource: disabled + value from user.agence.wilaya
        - bureauSource: disabled + value from user.agence._id
     
     2. AFFICHAGE CONDITIONNEL:
        - bureauDestRow: visible si typelivraison = "bureau"
        - adresseDomicileRow: visible si typelivraison = "domicile"
     
     3. CALCUL FRAIS:
        D√©clench√© lors de:
        - Changement de wilayaDest
        - Changement de typelivraison
        - Changement de poidsColis
        
        Formule:
        - Si poids ‚â§ tarifBase.poidsMax: frais = tarifBase.montant
        - Si poids > tarifBase.poidsMax: frais = tarifBase.montant + (poids - tarifBase.poidsMax) √ó tarifParKg
     
     4. VALIDATION:
        - Tous les champs avec * sont required
        - T√©l√©phone: 10 chiffres
        - Poids > 0
        - Prix >= 0
        - Si bureau: bureauDest required
        - Si domicile: adresseLivraison required
     
     5. APIs UTILIS√âES:
        - GET /api/frais-livraison ‚Üí Liste wilayas + tarifs
        - GET /api/agences?wilaya=CODE ‚Üí Bureaux filtr√©s
        - GET /api/auth/me ‚Üí Info utilisateur (agence)
        - POST /api/colis ‚Üí Cr√©ation colis
     
-->